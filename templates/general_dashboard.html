<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>General Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        h2 { text-align: center; }

        /* Table styling */
        table#expTable { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 20px; 
        }
        table#expTable th, table#expTable td { 
            border: 1px solid #ccc; 
            padding: 8px; 
            text-align: center; 
        }
        table#expTable th { background-color: #f4f4f4; }
        table#expTable tr.over { background-color: #ffcccc; }

        #searchBar { width: 100%; padding: 8px; margin-bottom: 10px; }

        /* Modal styling */
        #feedbackModal {
            display:none; 
            position:fixed; 
            top:0; left:0; 
            width:100%; height:100%; 
            background: rgba(0,0,0,0.5); 
            justify-content:center; 
            align-items:center;
            z-index: 1000;
        }
        #feedbackModal div {
            background:#fff; 
            padding:20px; 
            border-radius:8px; 
            width:300px; 
            text-align:center; 
            position:relative;
        }
        #feedbackModal textarea { width:100%; margin-bottom:10px; }
        #feedbackModal span#closeModal { position:absolute; top:5px; right:10px; cursor:pointer; font-size:20px; }
    </style>
</head>
<body>
    <h2>General Dashboard</h2>

    <input type="text" id="searchBar" placeholder="Search by category name...">
    <table id="expTable">
        <thead>
            <tr>
                <th>Category</th>
                <th>Budget Limit</th>
                <th>Amount Spent</th>
                <th>Remaining</th>
            </tr>
        </thead>
        <tbody>
            {% for exp in expenditures %}
            <tr class="{% if exp.spent > exp.budget %}over{% endif %}">
                <td>{{ exp.name }}</td>
                <td>{{ "{:,.2f}".format(exp.budget) }}</td>
                <td>{{ "{:,.2f}".format(exp.spent) }}</td>
                <td>{{ "{:,.2f}".format(exp.remaining) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Feedback Button -->
    <button id="feedbackBtn" style="margin-top:20px; padding:10px 20px;">Give Feedback</button>

    <!-- Feedback Modal -->
    <div id="feedbackModal">
        <div>
            <span id="closeModal">&times;</span>
            <h3>Feedback</h3>
            <textarea id="feedbackText" rows="4" placeholder="Write your feedback..."></textarea>
            <button id="submitFeedback" style="padding:8px 16px;">Submit</button>
        </div>
    </div>

    <script>
        // Search functionality
        const searchInput = document.getElementById('searchBar');
        const table = document.getElementById('expTable');
        const rows = table.getElementsByTagName('tr');

        searchInput.addEventListener('keyup', function() {
            const filter = searchInput.value.toLowerCase();
            for (let i = 1; i < rows.length; i++) {
                const td = rows[i].getElementsByTagName('td')[0];
                rows[i].style.display = td && td.textContent.toLowerCase().includes(filter) ? '' : 'none';
            }
        });

        // Feedback Modal
        const feedbackBtn = document.getElementById('feedbackBtn');
        const feedbackModal = document.getElementById('feedbackModal');
        const closeModal = document.getElementById('closeModal');
        const submitFeedback = document.getElementById('submitFeedback');
        const feedbackText = document.getElementById('feedbackText');

        feedbackBtn.addEventListener('click', () => feedbackModal.style.display = 'flex');
        closeModal.addEventListener('click', () => feedbackModal.style.display = 'none');

        submitFeedback.addEventListener('click', () => {
            const feedback = feedbackText.value.trim();
            if(feedback === "") {
                alert("Please enter feedback!");
                return;
            }
            fetch('/api/feedback', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ feedback })
            })
            .then(res => res.json())
            .then(data => {
                alert(data.message);
                feedbackModal.style.display = 'none';
                feedbackText.value = '';
            })
            .catch(err => alert("Error submitting feedback!"));
        });

        // Close modal on outside click
        window.addEventListener('click', (e) => {
            if(e.target === feedbackModal) feedbackModal.style.display = 'none';
        });
    </script>
</body>
</html>
            

